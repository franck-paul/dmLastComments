"use strict";dotclear.dmLastCommentsSpam=e=>{dotclear.services("dmLastCommentsSpam",(t=>{try{const a=JSON.parse(t);if(!a?.success)return void console.log(dotclear.debug&&a?.message?a.message:"Dotclear REST server error");if(a?.payload.ret){const t=a.payload.nb;void 0!==t&&t!=dotclear.dmLastComments_SpamCount&&(dotclear.badge(e,{id:"dmls",remove:0==t,value:t,sibling:!0,icon:!0}),dotclear.dmLastComments_SpamCount=t)}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastCommentsRows=(e,t)=>{dotclear.services("dmLastCommentsRows",(e=>{try{const a=JSON.parse(e);if(!a?.success)return void console.log(dotclear.debug&&a?.message?a.message:"Dotclear REST server error");if(a?.payload.ret){const{counter:e}=a.payload;$("#last-comments ul").length&&$("#last-comments ul").remove(),$("#last-comments p").length&&$("#last-comments p").remove(),e>0&&(dotclear.dmLastComments_LastCounter=Number(dotclear.dmLastComments_LastCounter)+e),$("#last-comments h3").after(a.payload.list),dotclear.dmLastComments_Badge&&(dotclear.badge($("#last-comments"),{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:0==dotclear.dmLastComments_LastCounter}),t.each((e=>{dotclear.badge(t[e],{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:0==dotclear.dmLastComments_LastCounter,inline:!0})}))),$.expandContent({lines:$("#last-comments li.line"),callback:dotclear.dmLastCommentsView}),$("#last-comments ul").addClass("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,stored_id:dotclear.dmLastComments_LastCommentId,last_id:e,last_counter:dotclear.dmLastComments_LastCounter})},dotclear.dmLastCommentsCheck=e=>{dotclear.services("dmLastCommentsCheck",(t=>{try{const a=JSON.parse(t);if(!a?.success)return void console.log(dotclear.debug&&a?.message?a.message:"Dotclear REST server error");a?.payload.ret&&a.payload.nb>0&&(dotclear.dmLastCommentsRows(a.payload.last_id,e),dotclear.dmLastComments_LastCommentId=a.payload.last_id)}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,last_id:dotclear.dmLastComments_LastCommentId})},dotclear.dmLastCommentsView=(e,t="toggle",a=null)=>{if(null==$(e).attr("id"))return;const s=$(e).attr("id").substr(4),o=`dmlce${s}`;let m=document.getElementById(o);const n=a.metaKey||$(e).hasClass("sts-junk");m?($(m).toggle(),$(e).toggleClass("expand")):dotclear.getCommentContent(s,(t=>{if(t)return m=document.createElement("li"),m.id=o,m.className="expand",$(m).append(t),$(e).addClass("expand"),void e.parentNode.insertBefore(m,e.nextSibling);$(e).removeClass("expand")}),{metadata:!1,clean:n})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_lastcomments")),$.expandContent({lines:$("#last-comments li.line"),callback:dotclear.dmLastCommentsView}),$("#last-comments ul").addClass("expandable"),!dotclear.dmLastComments_AutoRefresh)return;let e=$('#main-menu li a[href="comments.php"]');if(e.length||(e=$("#main-menu li #menu-process-comments-fav, #main-menu li #menu-process-Comments")),dotclear.dmLastComments_LastCommentId=-1,dotclear.dmLastComments_LastCounter=0,dotclear.dmLastCommentsCheck(e),dotclear.dmLastComments_Timer=setInterval(dotclear.dmLastCommentsCheck,1e3*(dotclear.dmLastComments_Interval||30),e),!dotclear.dmLastComments_Badge)return;let t=$('#dashboard-main #icons p a[href="comments.php"]');t.length||(t=$("#dashboard-main #icons p #icon-process-comments-fav")),t.length&&(dotclear.dmLastCommentsSpam(t),dotclear.dmLastComments_TimerSpam=setInterval(dotclear.dmLastCommentsSpam,1e3*(dotclear.dmLastComments_Interval||30),t))}));
