"use strict";dotclear.dmLastCommentsSpam=()=>{dotclear.services("dmLastCommentsSpam",(e=>{try{const t=JSON.parse(e);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const e=t.payload.nb;void 0!==e&&e!=dotclear.dmLastComments_SpamCount&&(dotclear.badge($('#dashboard-main #icons p a[href="comments.php"]'),{id:"dmls",remove:0==e,value:e,sibling:!0,icon:!0}),dotclear.dmLastComments_SpamCount=e)}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastCommentsRows=e=>{dotclear.dmLastComments_LastCommentId=e,dotclear.services("dmLastCommentsRows",(e=>{try{const t=JSON.parse(e);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const e=t.payload.counter;$("#last-comments ul").length&&$("#last-comments ul").remove(),$("#last-comments p").length&&$("#last-comments p").remove(),e>0&&(dotclear.dmLastComments_LastCounter=Number(dotclear.dmLastComments_LastCounter)+e),$("#last-comments h3").after(t.payload.list),dotclear.dmLastComments_Badge&&(dotclear.badge($("#last-comments"),{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:0==dotclear.dmLastComments_LastCounter}),dotclear.badge($('#main-menu li a[href="comments.php"]'),{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:0==dotclear.dmLastComments_LastCounter,inline:!0,sibling:!0})),$.expandContent({lines:$("#last-comments li.line"),callback:dotclear.dmLastCommentsView}),$("#last-comments ul").addClass("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,stored_id:dotclear.dmLastComments_LastCommentId,last_id:e,last_counter:dotclear.dmLastComments_LastCounter})},dotclear.dmLastCommentsCheck=()=>{dotclear.services("dmLastCommentsCheck",(e=>{try{const t=JSON.parse(e);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");t?.payload.ret&&t.payload.nb>0&&dotclear.dmLastCommentsRows(t.payload.last_id)}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,last_id:dotclear.dmLastComments_LastCommentId})},dotclear.dmLastCommentsView=(e,t="toggle",a=null)=>{if(null==$(e).attr("id"))return;const s=$(e).attr("id").substr(4),o=`dmlce${s}`;let m=document.getElementById(o);const l=a.metaKey||$(e).hasClass("sts-junk");m?($(m).toggle(),$(e).toggleClass("expand")):dotclear.getCommentContent(s,(t=>{t?(m=document.createElement("li"),m.id=o,m.className="expand",$(m).append(t),$(e).addClass("expand"),e.parentNode.insertBefore(m,e.nextSibling)):$(e).removeClass("expand")}),{metadata:!1,clean:l})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_lastcomments")),$.expandContent({lines:$("#last-comments li.line"),callback:dotclear.dmLastCommentsView}),$("#last-comments ul").addClass("expandable"),dotclear.dmLastComments_AutoRefresh&&(dotclear.dmLastCommentsCheck(),dotclear.dmLastComments_Timer=setInterval(dotclear.dmLastCommentsCheck,3e4),dotclear.dmLastComments_Badge)){$('#dashboard-main #icons p a[href="comments.php"]').length&&(dotclear.dmLastCommentsSpam(),dotclear.dmLastComments_TimerSpam=setInterval(dotclear.dmLastCommentsSpam,3e4))}}));
