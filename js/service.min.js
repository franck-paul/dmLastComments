"use strict";dotclear.dmLastCommentsSpam=e=>{dotclear.services("dmLastCommentsSpam",(t=>{try{const o=JSON.parse(t);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");if(o?.payload.ret){const t=o.payload.nb;void 0!==t&&t!==dotclear.dmLastComments_SpamCount&&(dotclear.badge(e,{id:"dmls",value:t,remove:!t,sibling:!0,icon:!0}),dotclear.dmLastComments_SpamCount=t)}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastCommentsRows=(e,t)=>{dotclear.services("dmLastCommentsRows",(e=>{try{const o=JSON.parse(e);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");if(o?.payload.ret){const{counter:e}=o.payload;for(const e of document.querySelectorAll("#last-comments ul"))e.remove();for(const e of document.querySelectorAll("#last-comments p"))e.remove();e>0&&(dotclear.dmLastComments_LastCounter=Number(dotclear.dmLastComments_LastCounter)+e);const s=document.querySelector("#last-comments h3");if(s?.insertAdjacentHTML("afterend",o.payload.list),dotclear.dmLastComments_Badge){dotclear.badge(document.querySelector("#last-comments"),{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:!dotclear.dmLastComments_LastCounter});for(const e of t)dotclear.badge(e,{id:"dmlc",value:dotclear.dmLastComments_LastCounter,remove:!dotclear.dmLastComments_LastCounter,inline:!0})}jQuery.expandContent({lines:jQuery("#last-comments li.line"),callback:dotclear.dmLastCommentsView});for(const e of document.querySelectorAll("#last-comments ul"))e.classList.add("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,stored_id:dotclear.dmLastComments_LastCommentId,last_id:e,last_counter:dotclear.dmLastComments_LastCounter})},dotclear.dmLastCommentsCheck=e=>{dotclear.services("dmLastCommentsCheck",(t=>{try{const o=JSON.parse(t);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");o?.payload.ret&&o.payload.nb>0&&(dotclear.dmLastCommentsRows(o.payload.last_id,e),dotclear.dmLastComments_LastCommentId=o.payload.last_id)}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1,last_id:dotclear.dmLastComments_LastCommentId})},dotclear.dmLastCommentsView=(e,t="toggle",o=null)=>{if(null===e.getAttribute("id"))return;const s=e.getAttribute("id").substring(4),a=`dmlce${s}`;let m=document.getElementById(a);const n=o.metaKey||e.classList.contains("sts-junk");m?(m.style.display="none"===m.style.display?"":"none",e.classList.toggle("expand")):dotclear.getCommentContent(s,(t=>{if(t)return m=document.createElement("li"),m.id=a,m.className="expand",m.insertAdjacentHTML("afterbegin",t),e.classList.add("expand"),void e.parentNode.insertBefore(m,e.nextSibling);e.classList.remove("expand")}),{metadata:!1,clean:n})},dotclear.ready((()=>{Object.assign(dotclear,dotclear.getData("dm_lastcomments")),jQuery.expandContent({lines:jQuery("#last-comments li.line"),callback:dotclear.dmLastCommentsView});for(const e of document.querySelectorAll("#last-comments ul"))e.classList.add("expandable");if(!dotclear.dmLastComments_AutoRefresh)return;let e=document.querySelectorAll('#main-menu li a[href="comments.php"]');if(e.length||(e=document.querySelectorAll("#main-menu li #menu-process-comments-fav, #main-menu li #menu-process-Comments")),dotclear.dmLastComments_LastCommentId=-1,dotclear.dmLastComments_LastCounter=0,dotclear.dmLastCommentsCheck(e),dotclear.dmLastComments_Timer=setInterval(dotclear.dmLastCommentsCheck,1e3*(dotclear.dmLastComments_Interval||30),e),!dotclear.dmLastComments_Badge)return;let t=document.querySelectorAll('#dashboard-main #icons p a[href="comments.php"]');t.length||(t=document.querySelectorAll("#dashboard-main #icons p #icon-process-comments-fav")),t.length&&(dotclear.dmLastCommentsSpam(t),dotclear.dmLastComments_TimerSpam=setInterval(dotclear.dmLastCommentsSpam,1e3*(dotclear.dmLastComments_Interval||30),t))}));
