"use strict";dotclear.ready(()=>{dotclear.dmLastComments=dotclear.getData("dm_lastcomments");const e=(e,t="toggle",o=null)=>{dotclear.dmViewComment(e,"dmlce",o.metaKey||e.classList.contains("sts-junk"))},t=e=>{dotclear.services("dmLastCommentsSpam",t=>{try{const o=JSON.parse(t);if(!o?.success)return void console.log(dotclear.debug&&o?.message?o.message:"Dotclear REST server error");if(o?.payload.ret){const t=o.payload.nb;void 0!==t&&t!==dotclear.dmLastComments.spamCount&&(dotclear.badge(e,{id:"dmls",value:t,remove:t<=0,sibling:!0,icon:!0}),dotclear.dmLastComments.spamCount=t)}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})},o=t=>{dotclear.services("dmLastCommentsCheck",o=>{try{const s=JSON.parse(o);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");s?.payload.ret&&s.payload.nb>0&&(((t,o)=>{dotclear.services("dmLastCommentsRows",t=>{try{const s=JSON.parse(t);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){const{counter:t}=s.payload;for(const e of document.querySelectorAll("#last-comments ul"))e.remove();for(const e of document.querySelectorAll("#last-comments p"))e.remove();t>0&&(dotclear.dmLastComments.lastCounter=Number(dotclear.dmLastComments.lastCounter)+t);const a=document.querySelector("#last-comments h3");if(a?.insertAdjacentHTML("afterend",s.payload.list),dotclear.dmLastComments.badge){dotclear.badge(document.querySelector("#last-comments"),{id:"dmlc",value:dotclear.dmLastComments.lastCounter,remove:dotclear.dmLastComments.lastCounter<=0});for(const e of o)dotclear.badge(e,{id:"dmlc",value:dotclear.dmLastComments.lastCounter,remove:dotclear.dmLastComments.lastCounter<=0,inline:!0})}dotclear.expandContent({lines:document.querySelectorAll("#last-comments li.line"),callback:e});for(const e of document.querySelectorAll("#last-comments ul"))e.classList.add("expandable")}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1,stored_id:dotclear.dmLastComments.lastCommentId,last_id:t,last_counter:dotclear.dmLastComments.lastCounter})})(s.payload.last_id,t),dotclear.dmLastComments.lastCommentId=s.payload.last_id)}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1,last_id:dotclear.dmLastComments.lastCommentId})};dotclear.expandContent({lines:document.querySelectorAll("#last-comments li.line"),callback:e});for(const e of document.querySelectorAll("#last-comments ul"))e.classList.add("expandable");if(!dotclear.dmLastComments.autoRefresh)return;const s=document.querySelectorAll("#main-menu li #menu-process-comments-fav, #main-menu li #menu-process-Comments");if(dotclear.dmLastComments.lastCommentId=-1,dotclear.dmLastComments.lastCounter=0,o(s),dotclear.dmLastComments.timer=setInterval(o,1e3*(dotclear.dmLastComments.interval||30),s),!dotclear.dmLastComments.badge)return;const a=document.querySelector("#dashboard-main #icons p #icon-process-comments-fav");a&&(t(a),dotclear.dmLastComments.timerSpam=setInterval(t,1e3*(dotclear.dmLastComments.interval||30),a))});
